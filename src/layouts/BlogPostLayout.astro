---
import BaseLayout from './BaseLayout.astro';
import AuthorBio from '@/components/AuthorBio.astro';
import RelatedArticles from '@/components/RelatedArticles.astro';
import NewsletterSignup from '@/components/NewsletterSignup.astro';
import SocialShare from '@/components/SocialShare.astro';
import TableOfContents from '@/components/TableOfContents.astro';
import { Image } from 'astro:assets';

export interface Props {
  frontmatter: {
    title: string;
    description: string;
    publishDate: string;
    updateDate?: string;
    author: string;
    category: string;
    tags: string[];
    heroImage?: string;
    heroImageAlt?: string;
    featured?: boolean;
    draft?: boolean;
  };
}

const { frontmatter } = Astro.props;
const formattedDate = new Date(frontmatter.publishDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Calculate reading time (rough estimate: 200 words per minute)
const content = await Astro.slots.render('default');
const wordCount = content.split(' ').length;
const readingTime = Math.ceil(wordCount / 200);
---

<BaseLayout
  title={`${frontmatter.title} | RentGrab Blog`}
  description={frontmatter.description}
  image={frontmatter.heroImage}
  article={true}
  publishedTime={frontmatter.publishDate}
  modifiedTime={frontmatter.updateDate}
  author={frontmatter.author}
  keywords={frontmatter.tags}
>
  <article class="animate-fade-in">
    <!-- Hero Image (16:9 aspect ratio) -->
    {frontmatter.heroImage && (
      <div class="w-full aspect-video relative overflow-hidden bg-neutral-100">
        <img
          src={frontmatter.heroImage}
          alt={frontmatter.heroImageAlt || frontmatter.title}
          class="w-full h-full object-cover"
          loading="eager"
        />
      </div>
    )}
    
    <!-- Article Container -->
    <div class="article-container py-8 lg:py-12">
      <!-- Article Header -->
      <header class="mb-8">
        <!-- Category Tag -->
        <a href={`/blog/${frontmatter.category}`} class="tag mb-4">
          {frontmatter.category.replace('-', ' ')}
        </a>
        
        <!-- Title (max 80 characters enforced in content schema) -->
        <h1 class="text-h1 mb-4">
          {frontmatter.title}
        </h1>
        
        <!-- Meta Information -->
        <div class="flex flex-wrap items-center gap-4 text-small text-neutral-500">
          <span class="font-medium text-neutral-700">{frontmatter.author}</span>
          <span>•</span>
          <time datetime={frontmatter.publishDate}>{formattedDate}</time>
          <span>•</span>
          <span>{readingTime} min read</span>
        </div>
        
        {frontmatter.updateDate && (
          <p class="text-small text-neutral-500 mt-2">
            Updated: {new Date(frontmatter.updateDate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </p>
        )}
      </header>
      
      <!-- Social Share Buttons -->
      <SocialShare 
        title={frontmatter.title}
        url={Astro.url.href}
      />
      
      <!-- Table of Contents for long articles -->
      {wordCount > 1000 && (
        <TableOfContents />
      )}
      
      <!-- Article Content -->
      <div class="prose-rentgrab mt-8">
        <slot />
      </div>
      
      <!-- Tags -->
      {frontmatter.tags.length > 0 && (
        <div class="mt-12 pt-8 border-t border-neutral-200">
          <h3 class="text-small font-semibold text-neutral-700 mb-3">Tagged with:</h3>
          <div class="flex flex-wrap gap-2">
            {frontmatter.tags.map((tag) => (
              <a href={`/blog/tag/${tag}`} class="tag">
                {tag}
              </a>
            ))}
          </div>
        </div>
      )}
      
      <!-- Author Bio -->
      <AuthorBio author={frontmatter.author} />
      
      <!-- Newsletter Signup -->
      <NewsletterSignup 
        location="article-bottom"
        title="Get the latest rental insights"
        description="Subscribe to our newsletter for equipment rental tips, industry news, and exclusive offers."
      />
    </div>
    
    <!-- Related Articles (3-column grid) -->
    <RelatedArticles 
      currentCategory={frontmatter.category}
      currentTags={frontmatter.tags}
      currentSlug={Astro.url.pathname}
    />
  </article>
</BaseLayout>

<style>
  /* Article-specific animations */
  article {
    animation: fadeIn 0.3s ease-in-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>
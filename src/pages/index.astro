---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import BlogCard from '@/components/BlogCard.astro';
import NewsletterSignup from '@/components/NewsletterSignup.astro';

// Get all blog posts
const allPosts = await getCollection('blog');
const publishedPosts = allPosts.filter(post => post.data.draft !== true);

// Sort posts by date
const sortedPosts = publishedPosts.sort((a, b) => 
  new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);

// Get featured posts
const featuredPosts = sortedPosts.filter(post => post.data.featured);

// Get recent posts (non-featured)
const recentPosts = sortedPosts
  .filter(post => !post.data.featured)
  .slice(0, 6);
---

<BaseLayout>
  <!-- Hero Section -->
  <section class="bg-gradient-to-b from-primary-50 to-white py-16 lg:py-24">
    <div class="container-lg text-center">
      <h1 class="text-hero mb-6 animate-fade-in">
        Turn Idle Items into <span class="text-primary-500">Income</span>
      </h1>
      <p class="text-xl text-neutral-600 max-w-3xl mx-auto mb-8 animate-slide-up">
        Join the sharing economy revolution. Rent from neighbors, earn from what you own. 
        Be among the first to access RentGrab's peer-to-peer rental marketplace.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center animate-slide-up" style="animation-delay: 0.2s">
        <a href="#newsletter" class="btn-primary">
          Join the Waitlist
        </a>
        <a href="/blog/smart-renting/true-cost-buying-vs-renting" class="btn-secondary">
          Calculate Your Savings
        </a>
      </div>
    </div>
  </section>

  <!-- Featured Post -->
  <section class="container-lg py-12">
    <h2 class="text-h2 mb-8">Featured Article</h2>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      {featuredPosts.map((post) => (
        <div class="lg:col-span-2">
          <article class="article-card border-2 border-primary-500">
            <a href={`/blog/${post.slug}`} class="flex flex-col lg:flex-row group">
              <div class="lg:w-1/2 aspect-video overflow-hidden bg-neutral-100">
                {post.data.heroImage ? (
                  <img
                    src={post.data.heroImage}
                    alt={post.data.heroImageAlt || post.data.title}
                    loading="lazy"
                    class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                  />
                ) : (
                  <div class="w-full h-full bg-gradient-to-br from-primary-100 to-primary-50 flex items-center justify-center">
                    <span class="text-primary-300 text-6xl font-bold">Featured</span>
                  </div>
                )}
              </div>
              <div class="lg:w-1/2 p-8">
                <span class="tag mb-4 inline-block">
                  {post.data.category.replace('-', ' ')}
                </span>
                <h3 class="text-h1 mb-4 group-hover:text-primary-500 transition-colors">
                  {post.data.title}
                </h3>
                <p class="text-body text-neutral-600 mb-6">
                  {post.data.description}
                </p>
                <div class="flex items-center gap-2 text-small text-neutral-500">
                  <span class="font-medium text-neutral-700">{post.data.author}</span>
                  <span>â€¢</span>
                  <time datetime={post.data.publishDate.toString()}>
                    {new Date(post.data.publishDate).toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric'
                    })}
                  </time>
                </div>
              </div>
            </a>
          </article>
        </div>
      ))}
    </div>
  </section>

  <!-- Recent Posts Grid -->
  <section class="container-lg py-12">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-h2">Recent Articles</h2>
      <a href="/blog" class="text-primary-500 hover:text-primary-600 font-medium">
        View All â†’
      </a>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {recentPosts.map((post) => (
        <BlogCard
          title={post.data.title}
          description={post.data.description}
          href={`/blog/${post.slug}`}
          image={post.data.heroImage}
          imageAlt={post.data.heroImageAlt}
          category={post.data.category}
          author={post.data.author}
          publishDate={post.data.publishDate.toString()}
          tags={post.data.tags}
        />
      ))}
    </div>
  </section>

  <!-- Categories Section -->
  <section class="bg-neutral-50 py-12">
    <div class="container-lg">
      <h2 class="text-h2 mb-8 text-center">Explore Topics</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {[
          { name: 'Getting Started', href: '/blog/getting-started', icon: 'ðŸš€', desc: 'Your journey begins here' },
          { name: 'Maximize Earnings', href: '/blog/maximizing-earnings', icon: 'ðŸ’°', desc: 'Turn items into income' },
          { name: 'Smart Renting', href: '/blog/smart-renting', icon: 'ðŸŽ¯', desc: 'Save money, rent smart' },
          { name: 'Success Stories', href: '/blog/success-stories', icon: 'â­', desc: 'Real member experiences' },
          { name: 'Industry Insights', href: '/blog/industry-insights', icon: 'ðŸ“Š', desc: 'Sharing economy trends' },
          { name: 'Seasonal Guides', href: '/blog/seasonal-guides', icon: 'ðŸ“…', desc: 'Timely rental tips' },
          { name: 'Sustainability', href: '/blog/sustainability-impact', icon: 'ðŸŒ±', desc: 'Environmental impact' },
          { name: 'Platform Features', href: '/blog/platform-features', icon: 'ðŸ”§', desc: 'Coming soon' },
        ].map((category) => (
          <a
            href={category.href}
            class="bg-white p-6 rounded-lg text-center hover:shadow-md transition-all hover:-translate-y-1 group"
          >
            <span class="text-3xl mb-2 block">{category.icon}</span>
            <h3 class="font-semibold text-neutral-900 group-hover:text-primary-500 transition-colors">
              {category.name}
            </h3>
            <p class="text-xs text-neutral-500 mt-1">{category.desc}</p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Newsletter Section -->
  <section id="newsletter" class="container-lg py-12">
    <NewsletterSignup
      location="homepage"
      title="Get Early Access to RentGrab"
      description="Be among the first to turn idle items into income. Join the waitlist for exclusive launch benefits."
    />
  </section>

  <!-- CTA Section -->
  <section class="bg-primary-500 text-white py-16">
    <div class="container-lg text-center">
      <h2 class="text-h1 mb-4">Ready to Join the Sharing Economy?</h2>
      <p class="text-xl mb-8 opacity-90 max-w-2xl mx-auto">
        Whether you want to earn from unused items or save money by renting from neighbors, RentGrab makes peer-to-peer rentals simple, safe, and profitable.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href="#newsletter"
          class="bg-white text-primary-500 px-8 py-3 rounded-md font-semibold hover:bg-neutral-50 transition-colors"
        >
          Join Waitlist - Get 3 Months Free
        </a>
        <a
          href="/blog/getting-started/complete-guide-peer-to-peer-rentals"
          class="border-2 border-white text-white px-8 py-3 rounded-md font-semibold hover:bg-white hover:text-primary-500 transition-all"
        >
          Learn How It Works
        </a>
      </div>
    </div>
  </section>
</BaseLayout>